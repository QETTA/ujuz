# 03. iOS Permissions UX Guide (알림/위치)

## 목차
- [1. 목적](#1-목적)
- [2. 권한 요청 원칙](#2-권한-요청-원칙)
- [3. 알림 권한 UX](#3-알림-권한-ux)
- [4. 위치 권한 UX](#4-위치-권한-ux)
- [5. 권한 거절/철회 대응](#5-권한-거절철회-대응)
- [6. 카피 템플릿](#6-카피-템플릿)
- [7. 이벤트 로깅 기준](#7-이벤트-로깅-기준)
- [8. QA 체크리스트](#8-qa-체크리스트)

## 1. 목적
UjuZ iOS 앱에서 알림/위치 권한을 "필요 시점"에 요청하고, 거절 시에도 핵심 플로우(탐색/비교/상담)를 유지하기 위한 UX 기준을 정의한다.

## 2. 권한 요청 원칙
1. 앱 첫 실행 즉시 요청 금지.
2. 기능 진입 직전 요청(Just-in-time).
3. 프리프롬프트(왜 필요한지) 후 시스템 프롬프트 노출.
4. 거절해도 대체 경로 제공.
5. 설정 이동은 강요가 아닌 선택지로 제공.

## 3. 알림 권한 UX
### 3.1 요청 타이밍
- 트리거: `TO 알림 받기` 또는 `알림 구독 생성` 버튼 탭 시
- 금지: 홈 진입 직후, 회원가입 직후 자동 요청

### 3.2 권장 플로우
1. 프리프롬프트 노출: TO 변동을 놓치지 않기 위한 가치 설명
2. 사용자 동의 시 시스템 권한 팝업 요청
3. 허용 시 성공 토스트 + 테스트 알림 옵션 제공
4. 거절 시 앱 내 알림센터 폴백 안내

### 3.3 허용 후 기본값
- 알림 빈도 기본: `즉시`
- 사용자 선택 옵션: `즉시`, `하루 1회 요약`
- 조용한 시간 기본: `22:00~07:00`

## 4. 위치 권한 UX
### 4.1 요청 타이밍
- 트리거: `내 주변 시설 보기`, `거리순 정렬` 사용 시
- 요청 수준: `When In Use` 우선
- 금지: `Always` 권한을 초기 단계에서 요구

### 4.2 거절 시 폴백
- 시/구/동 수동 선택 검색
- 최근 검색 지역 저장
- 지도 중심을 사용자 지정 지역으로 유지

## 5. 권한 거절/철회 대응
- `Denied` 상태에서 반복 팝업 금지
- 재시도 버튼: `설정에서 권한 켜기`
- 안내 문구: "권한 없이도 검색/비교는 계속 사용할 수 있어요"
- 앱 설정 진입 경로를 2탭 내 제공(마이페이지 > 권한 관리)

## 6. 카피 템플릿
### 6.1 알림 프리프롬프트
- 제목: `TO 변동을 바로 알려드릴게요`
- 본문: `관심 어린이집의 결원/입소 기회가 생기면 빠르게 안내해요.`
- CTA: `알림 켜기`
- 보조 CTA: `나중에`

### 6.2 위치 프리프롬프트
- 제목: `내 주변 시설을 정확하게 찾으려면`
- 본문: `현재 위치를 사용하면 거리순 비교가 쉬워져요.`
- CTA: `위치 사용하기`
- 보조 CTA: `지역 직접 선택`

### 6.3 거절 후 안내
- 알림 거절: `앱 내 알림센터에서 새 소식을 확인할 수 있어요`
- 위치 거절: `지역을 직접 선택해도 동일한 정보를 볼 수 있어요`

## 7. 이벤트 로깅 기준
| 이벤트명 | 발생 시점 | 필수 속성 |
|---|---|---|
| `perm_push_preprompt_view` | 알림 프리프롬프트 노출 | `screen`, `subscription_id?` |
| `perm_push_preprompt_cta` | 프리프롬프트 버튼 탭 | `action=allow|later` |
| `perm_push_system_result` | 시스템 팝업 결과 | `result=granted|denied|provisional` |
| `perm_location_preprompt_view` | 위치 프리프롬프트 노출 | `screen` |
| `perm_location_system_result` | 위치 권한 결과 | `result=granted|denied|limited` |
| `perm_settings_open` | 설정 이동 탭 | `permission=push|location` |

## 8. QA 체크리스트
- [ ] 알림 권한은 구독 생성 시점에서만 요청된다
- [ ] 위치 권한은 거리 기능 사용 시점에서만 요청된다
- [ ] 권한 거절 후에도 검색/시설비교/상담은 정상 동작한다
- [ ] 권한 철회 후 재진입 시 무한 팝업이 발생하지 않는다
- [ ] 이벤트 로깅이 누락되지 않는다

